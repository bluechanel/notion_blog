---
id: 224be3c3-178a-49f0-af8e-1528acf9aa94
title: 🤖 QQ Bot+notion实现随手记
slug: 224be3c3-178a-49f0-af8e-1528acf9aa94
excerpt: 小玩具
date: 2022-08-16
coverImage: /images/224be3c3-178a-49f0-af8e-1528acf9aa94_5f7f0b6047be0b8e9579ef48a693e2f5.png
lastUpdated: 2025-04-11T05:51:00.000Z
tags: yellow:Notion  
---

习惯在QQ置顶一个小号，用于“随手记”。可能是某一时刻的想法，或者是链接等，每天早晨都会看之前的随手记，有些可以看到就做。还有一些是flag，当前可能做不了，需要稍后的，QQ查看之前的聊天的记录，已完成未完成混杂在一起，查看起来有些麻烦。随着notion开放API，便想到了使用QQ或wechat输入（这个两个app每天打开无数次），notion收集。经过研究，wechat接入第三方应用非常的麻烦，可行性太低。QQ则可以借助各种qq bot工具实现第三方的接入。因此我便使用[cqhttp](https://github.com/nonebot/aiocqhttp)+python脚本实现自己的收集工具，具体过程如下(在腾讯云服务器实现)


# [cqhttp](https://github.com/Mrs4s/go-cqhttp)

1. 在[github](https://github.com/Mrs4s/go-cqhttp/releases)下载合适的安装包到本地机器，并解压 支持win，linux，macos
2. 首次执行`./go-cqhttp`，生成配置文件config.yml

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/74d2b771-a6b7-4c6b-bfb8-41fbb62aa2e4/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466R2UHDOZL%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T083758Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECAaCXVzLXdlc3QtMiJHMEUCIFqtF0MBXuhcfDsQeFlnv7wFZaDKJtj3VKZndDFwdX%2BYAiEAgDlVO6RtGWGfRTAgItuEoW93whM0FqNnIZ5vF66nfvkq%2FwMIKRAAGgw2Mzc0MjMxODM4MDUiDFbo2ffQv%2FpppnC9ESrcA6tEshEOXoMH49JThqRSluyhSz1aG0ePPB01OfowQFNMw9QBRlIeaxQQAwPP45%2FoyY%2ButK4cTpuXDVbmfe8Lq9fKF5OcAR1MhdQ0yltoR5ILrPnnB9DdpfKz4X1lbMx%2F9eH6zhI6H7A1B2nn63PMgV020eM%2BHi2oeOlp0bGWgHf34ExSphdq5cE%2FhKdggmEQZ0sHxz0rhYTkudXnBYPRSYDutloun74AubotuLM3jlsFPvv3vgTU6Njwy2Ae6vATfMtlEZ%2BCMrrsl1bw8H6DTmfI2o6Bu53ipe6SAV7otqjHWrFEVUysTbzXnSgrjhDxYzs3VKuPY0YVJwYTYiRaTFluWV2%2F05eoSELXnRbRdRXTwbpuvjsFzqOjtEJ4tQMZLBJVzpu%2F5edLwImgXYLL5u77AeyQsXyc5JkDMyd4JBOiNZ5gloFYcmXh%2BjkjgIwa5F4wxX5rJKorE4qMd%2Bb4J9s4C8SlzJOmXjLLbsKP%2BcA5CyZZ8ui01cvTC599kRFyy5KPUmvMgd4WqnhX4wp8cEdJzfB2TBgenTib3Mx9VP%2FsFzn5075Zb0VT0MSW1ojAS0lcAvidICrQCAgrEyT%2Bd8JmF32Nvl7l2yxvEi7ZUKc8Z1nR%2FAA3SnlSbkW3MMKNnsMGOqUBjByeDoDz1LGtc4KZiAoV8Nmlb0x2w%2FDkSo13ccyxEEz42IXoBbkeMB4nl5oLXEACsTapphGcqDhiKM9TSx3FIOLGrueS%2Bq77pWNou4vQ24cmg2JMHF5P7Qzrx6n17mHjCEXq500uLHDHR7Vo6W01xSC%2BirqdNIDfxzLGbjlfmxYnv0Ig0cw4DkzqHgu%2BP6K5og1tBq0rbCaI42S0dWfaVZVEi4Ns&X-Amz-Signature=537db15faae7e7e206d8ec1c2dc84b2aedb4ba69cce3bbc5ce45f0476848ebf7&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

3. 修改config.yml ,配置账户和密码。记住下面的servers的链接端口。更新详细的[配置参考官方](https://docs.go-cqhttp.org/guide/config.html#%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF)

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/79142ab5-969e-48e6-934c-75120cc752cd/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB46677UCJ4TS%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T083758Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECAaCXVzLXdlc3QtMiJGMEQCIDLzWHvhad%2BCaExr%2BPagn4U0lMeCNFyS6BxLAEn9%2FCQQAiANE97GCTNFaQepX6U0PTZQaQ8FXJtsJMnRGgdK3DY2kCr%2FAwgpEAAaDDYzNzQyMzE4MzgwNSIMumEkK0hmrfNAxDVAKtwDZqS7yKMmAyJkFRPo%2BMPwUm25QzPrtsx1evbQKDy3zUG%2BBVSIdJanWhzTboyGKtqvljb39QSMWYeThaKkuleRI8c%2Fz63hW6IDVBtxFU5ALEcENo1rYc1OKx1RjYMv3%2BCmpV7pjPfvhz%2FLq5qh3ijgOs3T3TQoRnqFYcvy45RCm9pPKIdeq43KETJ3Ws%2F08271RUW6TYjmx%2FIXHnirch%2Bw1ulW8yVOH%2F4eBNticeCfSX7a5vAg1OKHAcP%2FRKajuk8k%2BAu%2FksYhYtXZsy0E%2F2IYpO69mN5G0dtWPuqjDXcyCg5Fl7SWCr7z3%2F6UxL53%2F3mwen22vhPDi76HxVpf9ZTKUiaP%2BvjMbKzrXGDAM28ms3fxzLK1Ok2z10FUjV40Gh%2Fc9eSvbc3t%2Fxyi766vRQYqjXgSM4J4ACz8PKNpS24IeVgJVtIYLHsIpxeWmPU2rsMwcbYx4Fztie8AdcZYF9drc1rWSKf6y3%2FUn6IE8xwYvU9ww6hCJOwd0NILlLMla6S8a0iEP%2FZKVo0%2Fn%2F8BTm%2Bu0vag5bWUdqzegiBqxhvfGAHhwWWbPeAXxRzljMC8i2B8SuW28sjjpGWpskccyMSng4Yi7942clJkBOyRohCVm0CUcf5R%2FHbdu4pHW1gwx4yewwY6pgHbpXPephC4D4XF3yxDVaFPP6w9EwNvjGmZt6AQ97mAjbqr7c%2BSM0Rkuuiuuvc%2FNbjMgw46smezx5JKQERYX%2FMSueR6sZPJxE4K%2FSIgCtpM8uwzccb3lNq8gjJ6zssmCYgjrOK0LaUm9r86Ao6eciNY5fBzC6QkNNX1gpgljC8NGXO7h5iDDXVx6EkbDFg3%2BD81jOKlplYb3hcc0CJYsnqHub4fEtnD&X-Amz-Signature=86ebb88f13b84c741e6caac7424dd53b2478e3c7621872258d6ba77c99e7d5de&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/2dff1ba7-3e89-40cd-a7ae-15fc422a578d/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB46677UCJ4TS%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T083758Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECAaCXVzLXdlc3QtMiJGMEQCIDLzWHvhad%2BCaExr%2BPagn4U0lMeCNFyS6BxLAEn9%2FCQQAiANE97GCTNFaQepX6U0PTZQaQ8FXJtsJMnRGgdK3DY2kCr%2FAwgpEAAaDDYzNzQyMzE4MzgwNSIMumEkK0hmrfNAxDVAKtwDZqS7yKMmAyJkFRPo%2BMPwUm25QzPrtsx1evbQKDy3zUG%2BBVSIdJanWhzTboyGKtqvljb39QSMWYeThaKkuleRI8c%2Fz63hW6IDVBtxFU5ALEcENo1rYc1OKx1RjYMv3%2BCmpV7pjPfvhz%2FLq5qh3ijgOs3T3TQoRnqFYcvy45RCm9pPKIdeq43KETJ3Ws%2F08271RUW6TYjmx%2FIXHnirch%2Bw1ulW8yVOH%2F4eBNticeCfSX7a5vAg1OKHAcP%2FRKajuk8k%2BAu%2FksYhYtXZsy0E%2F2IYpO69mN5G0dtWPuqjDXcyCg5Fl7SWCr7z3%2F6UxL53%2F3mwen22vhPDi76HxVpf9ZTKUiaP%2BvjMbKzrXGDAM28ms3fxzLK1Ok2z10FUjV40Gh%2Fc9eSvbc3t%2Fxyi766vRQYqjXgSM4J4ACz8PKNpS24IeVgJVtIYLHsIpxeWmPU2rsMwcbYx4Fztie8AdcZYF9drc1rWSKf6y3%2FUn6IE8xwYvU9ww6hCJOwd0NILlLMla6S8a0iEP%2FZKVo0%2Fn%2F8BTm%2Bu0vag5bWUdqzegiBqxhvfGAHhwWWbPeAXxRzljMC8i2B8SuW28sjjpGWpskccyMSng4Yi7942clJkBOyRohCVm0CUcf5R%2FHbdu4pHW1gwx4yewwY6pgHbpXPephC4D4XF3yxDVaFPP6w9EwNvjGmZt6AQ97mAjbqr7c%2BSM0Rkuuiuuvc%2FNbjMgw46smezx5JKQERYX%2FMSueR6sZPJxE4K%2FSIgCtpM8uwzccb3lNq8gjJ6zssmCYgjrOK0LaUm9r86Ao6eciNY5fBzC6QkNNX1gpgljC8NGXO7h5iDDXVx6EkbDFg3%2BD81jOKlplYb3hcc0CJYsnqHub4fEtnD&X-Amz-Signature=c29bfba33160f192bd22a63cce5a3845bd2d86b76b4bc295ab3b4cdd2a993f84&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

4. 再次使用`./go-cqhttp`启动，可能会展示二维码，需要使用手机扫描验证后即可登录。`ctrl+c`终止掉程序
5. 使用命令后台运行`nohup ./go-cqhttp &`

# python脚本与cq通讯


python环境的安装不在赘述。这里使用python sdk `aiocqhttp`[官网](https://aiocqhttp.nonebot.dev/#/getting-started)

1. 安装包`pip install aiocqhttp`
2. 执行最小的demo，查看链接状况

    ```javascript
    from aiocqhttp import CQHttp, Event
    
    bot = CQHttp()
    
    
    @bot.on_message('private')
    async def _(event: Event):
        await bot.send(event, '你发了：')
        return {'reply': event.message}
    
    
    bot.run(host='127.0.0.1', port=18080)
    ```

3. 这个时候使用其他的账号给小号发送消息，即可收到小号的回复

# python脚本调用notionAPI

1. 创建[notion集成工具](https://testblog.wileyzhang.com/my-integrations)

    填写name，为工具取名，我这里取名`Collection of materials`，以及设置访问权限后，保存。即可看到访问token


    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/d13675e1-10c9-48ca-abb4-7ac7aa58991d/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466ZYNJSCBO%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T083759Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECAaCXVzLXdlc3QtMiJIMEYCIQC1%2B6FNx%2BZzS6inNgRt%2FTw3E0Hqu0Snxyxtdu5rh5D%2BzAIhAIvyDe4NCJZNstOl8CKYzKAZ2GX4u5ISfnlVPJumCT2iKv8DCCkQABoMNjM3NDIzMTgzODA1IgxECndI0GnhfAlBIOgq3ANW90EH8WNK8kMAJxArlLT%2B3FI9ckrZkJ3OTrvom7QTUKz7dixRyONYbsmNF0GpKg3yclJVPJLg2juuyMv5USE8JIEw3l%2BwjJBu2zOio2uLBeqMS07w7Rk4oGNXieKD29ueQqH1DBsU8xf3YTHOyfO%2FDR%2FO2RCHerYJjtUUBkCdIAtIU0kpgzOVPaizmG4CMc2fML8UitJBEJKjOCzXnvwZVvIkBdY2S7mNhVEbabmX2vdzShTzIbljeW9GO8%2B2cr16NFCSAEFR813%2FRgUzT3ZuqK%2FEbqrGY4cmVYOa22z3UxG8aWUWtPJRH0YndWPe8ODIuOf8hFwTYQ3uWubuC2PrYIemRlAbgr6HGteom%2FT9LjrwqyP8cjseKxB5WCCbGsrdpVluy2J%2FBJpr76ADLgl%2FCbiU4lXnJAzw1KSSWa9F0yhPkNbdNmZhxHbdJBZx7%2BnAB39HCYjZxUB2F14eQVdBk25nkzZ6kBOr2ApAijjNIISD%2F6cwOgWa6hpjHzuPwUYpum76fi3IQPxntTBiuwYwVjuLzeZG8KmYqgFaB8eXfbyEAW9hvgQjIasTx222x%2Benp0Y1euBdQuHUW4eesjox0gEcRZj5yIR6Wl%2B%2FOdB1WOGBgNfzJl8vWhCRDTDJjJ7DBjqkARrOrJYQN41kkJMv67XchOLEVMbIWSGvTYoorU44ru9WpV6SBHo74NU27f3cv7axUFVMAM3iY69fpbW0ogROz4ch4jX6wY7UHhsvxK9j0PCKlGC%2FIsEjPmXGWMG8yLMg3hkjR2R%2Fuf81uzSGFqKosudNQLKcUBul7c%2BsILP8O13IMLAo66fSyleeVO3sfzwZ8jtouNV4CtSNJDeX6gjskzjL6sw2&X-Amz-Signature=e78281a67b76cc962b6d2d86bf4046430a07cbefaae5de3adaff086bcaaac3a7&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

2. 创建notion页面，使用模板库的todo。按自己需求修改

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/65e07c30-636a-406d-b39f-51e7cd961a74/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466R73RGRZ7%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T083802Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECAaCXVzLXdlc3QtMiJGMEQCIH%2FHe6cO1GeuY%2FuclPmbc9Q8UyFsdKyPgBqXqZfqZMtXAiAE6Mg7zrhovgiNsJ2DPeXgyBGBO7QG24wGYWXDRe5JASr%2FAwgpEAAaDDYzNzQyMzE4MzgwNSIMSPjZ87EAj9UNYPsCKtwDOOQ4kyZ9tnnV%2Fmkq9FsQz0BAihKvKtgQ0X%2FKPL7z1%2BkBdPT7cwIrzz2rhezX3ur20tZaydmi6574WvRjs%2FguM%2BhFmWPWDNkKM95yoRfdHDyUhQRnnyMocJsgNy1gcG%2F9Vgk%2BxkjUPTAfPMjHtx2a4qVBcP2rm%2F%2Fst6flLZiO7ynwXchuZcVgGu2OKU2mDL0paqz%2BKWJh7b1pX1zLsfrLrrAslKn6ToWjnqIXCFhn6ULzPpf32wLNI9Znw%2FYstZCAe8qWPWLmHIjzUofq3PEpfcGvkpCH6EP5ImxskLBlv2299JrGqGDgBB3FAWm971ffZhkUs728g53Lht1ZFrWeoSxvvqkMr7Fg8zzuPVAGWcYxY6MusI0q4h28R9TqXHJGYvf2fO%2BYq3h1TGYbZpHeXTgToVlPmChPeCqsv5mFaHBMxtvz3aIhA4gGaNjxtJ85O%2B5betKlQqsjGhEipJOI77ZjWjDKbuOAxzWvYhQASvCmnLjLakGaEAOFFmQ04fzAhR9%2FXJ4kO0IXhdqR2JY%2BeePaATpwH6AvgCJAKyUiFXtL5W1wA%2BL9wRtPpRGHOnr46jqtNaUhb%2BM2UJuWnfBqZmaipiY1b2o8f72zH7Hzr008lgz7b1eqzWqLRDMwyYyewwY6pgFVbb2R4J2tGA7Xj9k4Pcoq7b7uRGfN0K6Ja1SB8rByWqd%2BLGD3wGy2%2BEz8EQnhNC7MK9TCzFuY%2FvZmU36P8SMC3Sj%2FoLNrQcql7GXwAMPdOU3VZYuRMPyY3Jz9Kdjn%2FEm%2BHUKAjw69pfG5LGGr09p7yZKDrCY9%2BFq2BBd3oVjUw%2BpdHie4nT4p8ObyPAcBxZahYG7F%2BPf1hpqQMbx4ydben7B9gPi6&X-Amz-Signature=b1db4a02cda444af620b6eadbcdea1a58893f57add6939d3f0a7877aed2c258a&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


    我这里修改Status为Status类型，保留创建时间属性，其他删除。这里的属性关乎API中的数据结构的组装


    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/04441044-2bf6-4847-a9e7-53b6bdc233ca/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466R73RGRZ7%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T083802Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECAaCXVzLXdlc3QtMiJGMEQCIH%2FHe6cO1GeuY%2FuclPmbc9Q8UyFsdKyPgBqXqZfqZMtXAiAE6Mg7zrhovgiNsJ2DPeXgyBGBO7QG24wGYWXDRe5JASr%2FAwgpEAAaDDYzNzQyMzE4MzgwNSIMSPjZ87EAj9UNYPsCKtwDOOQ4kyZ9tnnV%2Fmkq9FsQz0BAihKvKtgQ0X%2FKPL7z1%2BkBdPT7cwIrzz2rhezX3ur20tZaydmi6574WvRjs%2FguM%2BhFmWPWDNkKM95yoRfdHDyUhQRnnyMocJsgNy1gcG%2F9Vgk%2BxkjUPTAfPMjHtx2a4qVBcP2rm%2F%2Fst6flLZiO7ynwXchuZcVgGu2OKU2mDL0paqz%2BKWJh7b1pX1zLsfrLrrAslKn6ToWjnqIXCFhn6ULzPpf32wLNI9Znw%2FYstZCAe8qWPWLmHIjzUofq3PEpfcGvkpCH6EP5ImxskLBlv2299JrGqGDgBB3FAWm971ffZhkUs728g53Lht1ZFrWeoSxvvqkMr7Fg8zzuPVAGWcYxY6MusI0q4h28R9TqXHJGYvf2fO%2BYq3h1TGYbZpHeXTgToVlPmChPeCqsv5mFaHBMxtvz3aIhA4gGaNjxtJ85O%2B5betKlQqsjGhEipJOI77ZjWjDKbuOAxzWvYhQASvCmnLjLakGaEAOFFmQ04fzAhR9%2FXJ4kO0IXhdqR2JY%2BeePaATpwH6AvgCJAKyUiFXtL5W1wA%2BL9wRtPpRGHOnr46jqtNaUhb%2BM2UJuWnfBqZmaipiY1b2o8f72zH7Hzr008lgz7b1eqzWqLRDMwyYyewwY6pgFVbb2R4J2tGA7Xj9k4Pcoq7b7uRGfN0K6Ja1SB8rByWqd%2BLGD3wGy2%2BEz8EQnhNC7MK9TCzFuY%2FvZmU36P8SMC3Sj%2FoLNrQcql7GXwAMPdOU3VZYuRMPyY3Jz9Kdjn%2FEm%2BHUKAjw69pfG5LGGr09p7yZKDrCY9%2BFq2BBd3oVjUw%2BpdHie4nT4p8ObyPAcBxZahYG7F%2BPf1hpqQMbx4ydben7B9gPi6&X-Amz-Signature=d0c7268ce2be5c56181e22c7c10cdda3edb2055de61def2ab9e8ea9be4575c3b&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

3. 给todo页面 选择刚才创建的连接工具

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/7ae2573f-8f5f-4573-bb57-8253156261d0/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466V6KQVPMM%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T083803Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECAaCXVzLXdlc3QtMiJGMEQCIHK9MRpNFEBZCkodnaPfZNlWHhXM9Gpm66nhlgrrQB4KAiAumAfjKKPyxvjPu38XNvNp%2Bs7MXt1SI1f6WuWix8sBHCr%2FAwgpEAAaDDYzNzQyMzE4MzgwNSIMrDks97PpVaMW7VHoKtwDS2RVaYn%2BHk5yUTMoV6UynNTsS3rMOfM%2F4jRjv0JQwlazrpyEGA9eDgSWvGU4plIfYsm0gv%2FFWGtARHjJpcVc6vZ%2Fo8mF9Eh%2FGZZbYUOzHGtxiQyUFZT0SaZvW6qdUFoFoDpvvtoytouhUlLuIOKlok5Tven3rSUc%2BvT1gtsDqIs6F49zu%2BdT4aSzdMoxV4HIzvSxoGwjkS4rnOWEVVAx7mr2kVB6PeIREnC1RdUFBi%2BCp0pzdrF2cOOUzhLc6Q61CUpflGsfTJqKr9qS4fNZD5xMau9KyfTJKCyboyDoSBrCv1uPNE%2B%2Bw%2BlGR8I0EP2%2BBRqtPfGh6aJlhURM7q1KWqpaRKlcbuPzmFeuHW4MacC7w9XbK%2Fc4pWbNVLIu8NlXmPouacLvUJLNfuvEQO2FiYqKmrWapWgKyq9dkNH2oFfA6NVMse6ZqaEn3b4QNcZbHH5n4zoq8TxTVVea0qNV8anTEqDPz6bU75byquIGOpvi14RH09XyE1OU6U0kuaGz%2BEkXD59hjumNjChxbphtleXYP158koRBG73dC7cxVsphmlhB9wa10EWzfeCq0QhZsJVPULDwgCl9D1xlYZ8TnO2BkoMhT7HShWY80Hqd4P7qSWwvntNCrwie0qswzI2ewwY6pgGhBMebsAqpvzWphRdXnxXJB5hoyU31kZ3o4jJAnH7bac4liUXHejbG%2BfgCCYxsxT2%2BqOIrmw4HqSIRlj96abxeol%2BVjXQ8YCDFMhLMh6QBQHY%2B8VJByTRvQBa%2BoNPk5LMP%2FCYVUDTjmi14BPo5HORg8%2BdzRm0Glwh8OBConcsO2Mj3I%2BjTnUd1gPut5vTCaoquAIBkSZVtO4GGcDMo%2B5McGQEBeOdd&X-Amz-Signature=94883928f612d1a96df0912e6dead3bcdde110e617fd50c2cd7bfc5d44087e1f&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

4. 编写py代码，验证集成工具的可用性。关于notion的数据结构，参考[官方文档](https://developers.notion.com/reference/intro)

    ```python
    import asyncio
    
    import httpx
    
    
    class NotionApi:
        NOTION_KEY = '' # 此处填写集成工具的token
        database_id = '' # 此处填写database页面的id，可在todo页面的url中找到
    
        def __init__(self):
            self.url = f"https://api.notion.com/v1/pages" # api地址，可在文档中找到
            self.headers = {
                "Accept": "application/json",
                "Notion-Version": "2021-08-16",
                "Authorization": f"Bearer {self.NOTION_KEY}"
            }
    
        async def insert_page(self, content: str) -> str:
            # database属性
            properties = {
                "Name": {
                    "title": [
                        {
                            "type": "text",
                            "text": {
                                "content": f"{content[0:14]}" # 截取前14个字符为page的标题
                            }
                        }
                    ]
                },
                "Status": {
                    "status": {
                        "name": "Next Up"
                    }
                }
            }
            # 页面内容
            children = [{
                "object": "block",
                "type": "paragraph",
                "paragraph": {
                    "text": [{"type": "text", "text": {"content": content}}]
                }
            }]
            # database 信息
            parent = {"type": "database_id", "database_id": self.database_id}
            data = {
                "parent": parent,
                "properties": properties,
                "children": children
            }
            async with httpx.AsyncClient() as client:
                r = await client.post(url=self.url, headers=self.headers, json=data)
                print(r.text)
                if r.status_code == 200:
                    return "收集成功!"
                else:
                    return "收集失败!"
    
    
    notion_database = NotionApi()
    
    if __name__ == '__main__':
        asyncio.run(notion_database.insert_page("测试notion API"))
    ```


    注意：

        1. 我们刚才创建的todo页面其实是一个database
        2. 我们要创建的各个todo其实是database下面的page
        3. 因此我们使用的api 是[创建page](https://developers.notion.com/reference/post-page)
5. 正常情况下，已经执行成功，可在todo页面看到

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/9029c7ff-64f1-442f-ac7b-df9705b03350/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466XNYIIWW3%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T083806Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjECAaCXVzLXdlc3QtMiJIMEYCIQDjSe%2FaksTpSyAze%2BgELBkmBY4o%2FDc2frf9okehNP2jZwIhAJBLG%2BIjqJoL6jwcXlvnqxQfev4VB1%2Bd%2FmuUjKoXUk40Kv8DCCkQABoMNjM3NDIzMTgzODA1Igz%2BrWXiStxytvLfGuIq3AM%2FTxk83TgFogyCMWVcxj6Q3yU%2FO62dE7H9ybanEW6w5tMgaXp0yjUj8m3zJhz53Xigvkbb0qWM1VIMvyqn%2BKR1VOk19mdDpckwFJ6nTSpnh9S1ezzYIOmcrKP5MT%2BsV5jL2TWqWREWn3LCTHzEjO%2BX6JsMTfZmdiV5sGgcp%2FOGM0FgVAJAhLiZYwRCyKFwjHnJfIA2ELYKngWqKmVaGX63N%2Bl2ozXTcu5B%2BdlnCcWcLx8QFgH%2BGRKJqgYeL1crbf46%2FSR86MP5Mfqy35RBp4iPiF4ZM8reUR3S2KAupcNHR%2BR4TSdpO6ffLhBMs0jyICYpXot%2BPz4TF5EX4jNnGY74ZelMm5vLFeo4sF34FoXOidP%2BQgvrquTfippYQesS7ClRaEpY20gUITD8HHO31RpfpL%2FnQt2HInxGCPIfxypc7%2BfkyX8v7X8hMdiFpCUO8d9LtWwqrnpMvEo8SIHVlO6OJ7%2BW%2BzYuOhsGQevcSLe4fGGR2gAcGXutPcD8Wj%2B3JGM%2BQRq05H9ibJ%2FLan9xPosADm8HvNnwVL9zy8P%2FdEXvWSP3HPrpjhN9BhZcl2sVUTzppTbqtCqrdu%2BpYuzb2VoUs0M9zgADOo7ZZowz5DGhXwXrdj6mmZeJLty8jTDPjZ7DBjqkAbRAk4T48%2B7GhkW%2Fld%2FZB5aitv%2FSNGWmuKH5BNhQaUeULgFr9SCWiyn3CMCGfRwT3sKWCHh0vCe5Lzb4IaIBN5CYOC%2Fk2PnkXOToUIRdQ26LZseMQeovBgwKwgehKf35XmNWO%2FPmVGp2HYj%2BfmKFD8VurpBhhpwTI5R8XFkV1oEkDSPh1dMZJX%2BtrGjjRo9AkfbcTiVL162BGO2IQQ8Mu%2BaFp5MM&X-Amz-Signature=fc45305502601b06b91980973d872c50e6a291b667ce5fbb1a45b3f0b65ec13d&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

6. 完整代码（bot.py）如下，在服务器执行`nohup python -u bot.py > bot.log 2>&1 &`

    ```python
    # -*- coding:utf-8 -*-
    from aiocqhttp import CQHttp, Event
    
    from action import sent
    
    import httpx
    
    
    class NotionApi:
        NOTION_KEY = ''
        database_id = ''
    
        def __init__(self):
            self.url = f"https://api.notion.com/v1/pages"
            self.headers = {
                "Accept": "application/json",
                "Notion-Version": "2021-08-16",
                "Authorization": f"Bearer {self.NOTION_KEY}"
            }
    
        async def insert_page(self, content: str) -> str:
            # database属性
            properties = {
                "Name": {
                    "title": [
                        {
                            "type": "text",
                            "text": {
                                "content": f"{content[0:14]}"
                            }
                        }
                    ]
                },
                "Status": {
                    "status": {
                        "name": "Next Up"
                    }
                }
            }
            # 页面内容
            children = [{
                "object": "block",
                "type": "paragraph",
                "paragraph": {
                    "text": [{"type": "text", "text": {"content": content}}]
                }
            }]
            # database 信息
            parent = {"type": "database_id", "database_id": self.database_id}
            data = {
                "parent": parent,
                "properties": properties,
                "children": children
            }
            async with httpx.AsyncClient() as client:
                r = await client.post(url=self.url, headers=self.headers, json=data)
                print(r.text)
                if r.status_code == 200:
                    return "收集成功!"
                else:
                    return "收集失败!"
    
    
    notion_database = NotionApi()
    
    bot = CQHttp()
    
    
    @bot.on_message('private')
    async def _(event: Event):
        n = await sent(notion_database.insert_page(event.message))
        await bot.send(event, n)
    
    
    bot.run(host='127.0.0.1', port=18080)
    ```


# 总结


整个过程中的难点是对notion API的理解，一开始以为添加todo是create a database，几经尝试后才搞清楚关系，这一点需要注意。其次是api 数据结构的组装，需要多查看[文档](https://developers.notion.com/reference/property-value-object)

