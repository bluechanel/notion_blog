---
id: 224be3c3-178a-49f0-af8e-1528acf9aa94
title: 🤖 QQ Bot+notion实现随手记
slug: 224be3c3-178a-49f0-af8e-1528acf9aa94
excerpt: 小玩具
date: 2022-08-16
coverImage: /images/224be3c3-178a-49f0-af8e-1528acf9aa94_5f7f0b6047be0b8e9579ef48a693e2f5.png
lastUpdated: 2025-04-11T05:51:00.000Z
tags: yellow:Notion  
---

习惯在QQ置顶一个小号，用于“随手记”。可能是某一时刻的想法，或者是链接等，每天早晨都会看之前的随手记，有些可以看到就做。还有一些是flag，当前可能做不了，需要稍后的，QQ查看之前的聊天的记录，已完成未完成混杂在一起，查看起来有些麻烦。随着notion开放API，便想到了使用QQ或wechat输入（这个两个app每天打开无数次），notion收集。经过研究，wechat接入第三方应用非常的麻烦，可行性太低。QQ则可以借助各种qq bot工具实现第三方的接入。因此我便使用[cqhttp](https://github.com/nonebot/aiocqhttp)+python脚本实现自己的收集工具，具体过程如下(在腾讯云服务器实现)


# [cqhttp](https://github.com/Mrs4s/go-cqhttp)

1. 在[github](https://github.com/Mrs4s/go-cqhttp/releases)下载合适的安装包到本地机器，并解压 支持win，linux，macos
2. 首次执行`./go-cqhttp`，生成配置文件config.yml

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/74d2b771-a6b7-4c6b-bfb8-41fbb62aa2e4/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466YIIJWGCZ%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T024502Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJIMEYCIQCkG3ctNTUv97BXg0Lab392nOvW6EylMlZYIbD9I%2FHR1wIhAOY0sphJDs8bVwN8p5Lk2xARbiDcjpPqK%2BTFVSlLdJuqKv8DCCMQABoMNjM3NDIzMTgzODA1IgyHZ1ojLVJ7FxisE3cq3AMMX4AyekW8BDf1uL0YGBOp6P9N%2Foa9RTEuBy9mi3DvmUgGkgcSMhz5qJszexAiEGeZP%2FhbDAYXANPM7I%2BhUskQFN0cJy5MVmvN1wwUQi4VvqpGcepQ0HAH8k9wT9pliXulLFyZ01zh8UGYn6i2npaD1WkYYHtTtsenG%2Flh2QCSGkmdLr9MbKncP3UHEErXsv7ik8vLbcG0jMBKXCIxp85md9%2BqFqKFYExzr0lIGt0rtYSaU%2BdiDUog2p2ApDPmykXsCT8XGZL3JLx07g4C4kMkGBgV9JoDgNIyLyqWkoebjMEoYZst6Y5oQKEgEigT1gbY4NLJj5eXp7D%2Fb520jW6lbaDxtAIrKjSbqMwLegprz6XVk0pUQ21Rv8FPE4Q3aX1L04Xf4Gzy4gIlPu5h%2FbWozxyNNaaTWZpciGnI4n9KPS59AlUEoSxKYs%2FBan0O3hoZOHeyQEA%2Fg3w28wrZZFlM6425Z97uEJ8oIKCe4fTHgk12GIBSTBMb3vRRNB5%2F71bO7vBEnvrfZHZhYvfuGqzqG7PisdLNfq7mP%2FWdTsm9J8u1u79VQhoe4Bb%2BzWO86%2FhstHO0bhxFIvJytnx5e8PuAJles9UHGItoFSbQIZ7U0V8mKeZNJ5%2Fdps8c7jDZ5ZzDBjqkAcV%2BCr6FyYCQjKOohdaRFH5%2B93L%2BMGFM5f7sQg8BXpQ%2BRk1ZEQFBX%2F4p60%2BMvLCrGSYgx8qZOjjf2oKnSv2wssFd8vaGCCdXOlz0C8bnWR%2FOrOUC7liJsT3uGO5S2uS3Zg%2BWb%2FlU8sEt%2FjKCqHkoWBRU%2FcYNLIBpV9GoQL4aOjvDlF3JtGbNI4O%2FX3PpYK%2BAXeR%2Bqp14WM3DfEeFehxDAGctnmNz&X-Amz-Signature=0968b69d926cecaf2851f2a16f984ce46b6563b6ed14e0a91c3bd579f35ef7df&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

3. 修改config.yml ,配置账户和密码。记住下面的servers的链接端口。更新详细的[配置参考官方](https://docs.go-cqhttp.org/guide/config.html#%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF)

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/79142ab5-969e-48e6-934c-75120cc752cd/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QRUKIJZU%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T024502Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJHMEUCIDZy2yJCGef%2FUxiuRdJra%2BtwFtvAXHfSZq4wavkd3ABfAiEAsr7XPkNITkai3XbN%2BmKy8DCM6667MJ5mgMZbCEAQZBAq%2FwMIIxAAGgw2Mzc0MjMxODM4MDUiDFJX%2BuL00SPDxHpl5CrcA4mSuJ1AkXF3nz5mPQGGyqetj8KZvmVXsiofpVbkymTn0vZON2PWJ52yDdBhGQz8vZ2c0SvSJVjBO8z3OOp0XOdlF4ILy08et0W4cTk4ppbx3ZShLspWJqbvKr5eJndUG0HBn2LRH8PN2MPevoCRJvILT5m%2BeXqVpCerURIzmAYye6hn0h%2F2Nb6Jb5cm04pTYUNesoazjS5j3YkYdsnC34MLPIaP4usZlkP%2B0lGzQqnWQ63w6czMqE1Q7MMT1NSMYgimON%2BnuQveeJClioOAyTud%2Fx89sRiEGaxo5nC%2FMuKxT9XR%2B%2Bf6a1e1bFIc5nx3MK6hs0Jo5ErDRFXIzmJKj1SSmS3R33wMEOrIyo7%2FLUDOTauD3sy6GwHylyy7x2YEmcdUNezIAxP1EOgpB2XhGQtOLoVjgeGAVLaQWnz1rsOFr7EtLpCn9t5ylsBTt72x7EEoCMoKhSXFI6M6693VzeL1MfN5CNEmh8sX3Tn4nPYS7MX1Z1srAUPjM4YnvsF0pmr%2B6yu1BAqUFCoB1eCOs%2BG98kh5YMubN2VvOJNKnBTplGr0UB6stKw05vx%2F1rXQhvmBy10mdE4uVOoWS8WFQ8ENCJ4BBjyxEynTtUpp%2F8GZ8YHwgpWmn%2FG5aU0%2FMJPknMMGOqUBT%2FSOzjiSurBqzL%2BCL0DJwhlhJoJ49BfJXiQW1u6fRcFC414rDR4CvCLAUVex4KS%2FU7fzkPBtCNZxCXR9wrZd%2BRxUjOCQVSQdfyret2AZvnUrk28dWyR1MTOSU0wJfQwZa3NMYR%2F%2FOrbnw7swXiZLZZDh2wdD3OBFnsHeiKlHjUsm%2BlrtScaE%2Fccd%2FGZ6Gc525KeYHKNdQITj8PcQyYiJF4Svs6Uy&X-Amz-Signature=c1858b5395ed8864bc56de3ca794f138c9a08c19160bb541a7768b98fb2878eb&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/2dff1ba7-3e89-40cd-a7ae-15fc422a578d/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466QRUKIJZU%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T024502Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJHMEUCIDZy2yJCGef%2FUxiuRdJra%2BtwFtvAXHfSZq4wavkd3ABfAiEAsr7XPkNITkai3XbN%2BmKy8DCM6667MJ5mgMZbCEAQZBAq%2FwMIIxAAGgw2Mzc0MjMxODM4MDUiDFJX%2BuL00SPDxHpl5CrcA4mSuJ1AkXF3nz5mPQGGyqetj8KZvmVXsiofpVbkymTn0vZON2PWJ52yDdBhGQz8vZ2c0SvSJVjBO8z3OOp0XOdlF4ILy08et0W4cTk4ppbx3ZShLspWJqbvKr5eJndUG0HBn2LRH8PN2MPevoCRJvILT5m%2BeXqVpCerURIzmAYye6hn0h%2F2Nb6Jb5cm04pTYUNesoazjS5j3YkYdsnC34MLPIaP4usZlkP%2B0lGzQqnWQ63w6czMqE1Q7MMT1NSMYgimON%2BnuQveeJClioOAyTud%2Fx89sRiEGaxo5nC%2FMuKxT9XR%2B%2Bf6a1e1bFIc5nx3MK6hs0Jo5ErDRFXIzmJKj1SSmS3R33wMEOrIyo7%2FLUDOTauD3sy6GwHylyy7x2YEmcdUNezIAxP1EOgpB2XhGQtOLoVjgeGAVLaQWnz1rsOFr7EtLpCn9t5ylsBTt72x7EEoCMoKhSXFI6M6693VzeL1MfN5CNEmh8sX3Tn4nPYS7MX1Z1srAUPjM4YnvsF0pmr%2B6yu1BAqUFCoB1eCOs%2BG98kh5YMubN2VvOJNKnBTplGr0UB6stKw05vx%2F1rXQhvmBy10mdE4uVOoWS8WFQ8ENCJ4BBjyxEynTtUpp%2F8GZ8YHwgpWmn%2FG5aU0%2FMJPknMMGOqUBT%2FSOzjiSurBqzL%2BCL0DJwhlhJoJ49BfJXiQW1u6fRcFC414rDR4CvCLAUVex4KS%2FU7fzkPBtCNZxCXR9wrZd%2BRxUjOCQVSQdfyret2AZvnUrk28dWyR1MTOSU0wJfQwZa3NMYR%2F%2FOrbnw7swXiZLZZDh2wdD3OBFnsHeiKlHjUsm%2BlrtScaE%2Fccd%2FGZ6Gc525KeYHKNdQITj8PcQyYiJF4Svs6Uy&X-Amz-Signature=1ed3cb0d0b8c2b6c8f9fcd5b5db979dbd195f76e25af8bd955d2d85501efbfeb&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

4. 再次使用`./go-cqhttp`启动，可能会展示二维码，需要使用手机扫描验证后即可登录。`ctrl+c`终止掉程序
5. 使用命令后台运行`nohup ./go-cqhttp &`

# python脚本与cq通讯


python环境的安装不在赘述。这里使用python sdk `aiocqhttp`[官网](https://aiocqhttp.nonebot.dev/#/getting-started)

1. 安装包`pip install aiocqhttp`
2. 执行最小的demo，查看链接状况

    ```javascript
    from aiocqhttp import CQHttp, Event
    
    bot = CQHttp()
    
    
    @bot.on_message('private')
    async def _(event: Event):
        await bot.send(event, '你发了：')
        return {'reply': event.message}
    
    
    bot.run(host='127.0.0.1', port=18080)
    ```

3. 这个时候使用其他的账号给小号发送消息，即可收到小号的回复

# python脚本调用notionAPI

1. 创建[notion集成工具](https://www.notion.so/my-integrations)

    填写name，为工具取名，我这里取名`Collection of materials`，以及设置访问权限后，保存。即可看到访问token


    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/d13675e1-10c9-48ca-abb4-7ac7aa58991d/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4662BKCAZ6K%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T024504Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJHMEUCIQDCoczkBLzJ74t30cXweYOnMAoY7Mzo0H%2FcROxuXBclCQIgDMDdYuSz1e7cKdzuDxWcJVk2nl9Jm3RtHdQ5ImIojI4q%2FwMIIxAAGgw2Mzc0MjMxODM4MDUiDHnG3gS%2Ft9gLUsIrjircA6gvbxUw7pkig%2FCpQpuxDxhqjuoAaIOKtGyB1QiRNRq5diMbeQZrYCKSbB%2BwxsHacPqcYCYy4QNIGTvL7fKJFMUQv4cFkbsgOnNbIXnX%2Bm9kXD1vtjnF2qxyzK6Yhj46E4HLt83yxdvvHbMpEuHXaUG1SaSI%2BUY4Tol6TDJyeQz23aPF%2BbEeaY%2BoD0heoZwKeD48Y4yxH6dNgA%2Bn8uswQKqRP2ipxi2euBmjB%2BcbSDPKSSEoYD1K4rK2f1k9SEKnd9Iz6sYIt%2FtGUQW55OxEeSt3uJSYxnf2mFAHJ4JtMODE0iPTcBaAo9qFZqGgxvnwrts%2BTuKW0PHAmb9SI8jk9j4o6tyDZf1tbeAyjheDEJPEb6rjF9ENRQB56ynUbujGP1ElCkYFTqQ06578UOQYrpmDR1o1GI0JN46rFWHjFmv3TSXVjgB7ttU0wB8OaPP4f2oW%2FU2cMxdk0l8eA9arpkcqIIXDPR8bk8MOTJaFr%2Fm5G3ynU5yTRZys9oIhkTi2zIpAjr2v81P8HFH8BJgMLooyT5nje4vw18Kg99KEdNNBQU3m%2BCTNhdzVVsZyDb%2BZXxWKUTLXy%2Fqygd5ce%2FjfBpcXbrOQhYxAT5tkQepWYTX82Z6g%2B0%2FkLt6uzep%2FMK7mnMMGOqUBIHNIeGixkqRC8Zg4Kawl9StSt9zwMIvIIcRtuzmEurFNfOvESgiEmLRW5q7kIoCz04b4vNQmKPHWHnlqKwbG8KAnu9rhZuT49LI%2BAzs1FPUouL6b2LvqVAYWPjpvbJWm1OtrV2LQBgrVBLV0HyItNKk9vPO2Tk%2Bu8%2BbwjZSLYcwBdz%2FcDPQesgiC7pTyMh2W05sl63SvekMQ2lDWRNk61GB40QCo&X-Amz-Signature=a79860031332c4a1c3f19f35c268efe39552f15f926e76b3b40d921d29e82410&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

2. 创建notion页面，使用模板库的todo。按自己需求修改

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/65e07c30-636a-406d-b39f-51e7cd961a74/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466YHRYONMM%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T024505Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJHMEUCIQDn8Gczx2vurDhLddqSCNZs9cmsgashDCmCeg1T8DKoCwIgSEvyS5kop7CUCb0jkFpFgCfg3Nmukl6gfVK3BEneR%2FUq%2FwMIIxAAGgw2Mzc0MjMxODM4MDUiDMxYQmaCvVUY0AbWRSrcA7QxvfQLfGJznZmMB%2F7VZ2yAN3SnpC7GYsmda4ClSsfzAEAJk%2FCGP1fNrEvsSuI4x0E3aNZw9X8oSH%2FdhriuEKXrpgrcBh%2FhkxadO9ChhuLckOALTtELxLfaE%2BaLJ43xcnFNzbi%2FtWHSGqENpCXktlRv2jxkca161avdNPgCo4gX0VQ5yufj1vMvIaZjAo2LOpwJfZY4NfKnXsvL3ring07IVesQs6uxqQmgenMouW6ZwmNC2Tc3HN9DiFi15LgVaUL%2B48oMHBwMGRl2FuzFIE6VyL8GNvX1Yqh9cnaEI6uQz4pAqQ7L01umiFnAbLw%2BwLQAnoPxwOphO6g0%2FX7xOE2eUX9XY5c3hKU9a3s3ypyy77OFMB5cZv1HxTVeNfmm2ND2EskSYs2sL53wmF%2FCAS%2FP4W%2FPB6QRnkdNHTjP%2BdG54ilW2JoY%2BLfUyX2bEtz2UaDn70ep1p948GKYpNRqPi8KnjCwx0DvezanD86%2FADiuAVa5VHLBVkB27NB2xmf1s17lF6ZCub4D4ILDZaw8ACjLreCool1pfBPicTi6yb%2BOtUv%2B4OYIAqfeSc1zURZJ6umel1LLMqa8JfAn0UEZfS6TgGOtgSkfYOyuzdXYigMUZdncGyaobgaY0vAhMJTlnMMGOqUBjUrRb5z0FggVCfMiMrDK5CvfHQNv%2BeeguHMjOLRtXDLPPLgBBb0h6dEO2BPPbwt5xyEAqunR5DIp%2FvAZ%2BczrFXjkz4Qc5BsWgsfZZCIA8Rs6dChMQZFDTYWu2q9DkX8oIKqfhpDwPOrdGT4AydTCz50C7ZbMoVF5Fmtz5mGhr5ltKLdJqroSn2XkIZvEBJVYbdnUsw7Q1nuVaubesnEhS9dEfiCa&X-Amz-Signature=8dda2a1f3eb98ff2cca71063175f709e23303f356da308f4b62ea2bf9abbcc84&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


    我这里修改Status为Status类型，保留创建时间属性，其他删除。这里的属性关乎API中的数据结构的组装


    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/04441044-2bf6-4847-a9e7-53b6bdc233ca/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466YHRYONMM%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T024505Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJHMEUCIQDn8Gczx2vurDhLddqSCNZs9cmsgashDCmCeg1T8DKoCwIgSEvyS5kop7CUCb0jkFpFgCfg3Nmukl6gfVK3BEneR%2FUq%2FwMIIxAAGgw2Mzc0MjMxODM4MDUiDMxYQmaCvVUY0AbWRSrcA7QxvfQLfGJznZmMB%2F7VZ2yAN3SnpC7GYsmda4ClSsfzAEAJk%2FCGP1fNrEvsSuI4x0E3aNZw9X8oSH%2FdhriuEKXrpgrcBh%2FhkxadO9ChhuLckOALTtELxLfaE%2BaLJ43xcnFNzbi%2FtWHSGqENpCXktlRv2jxkca161avdNPgCo4gX0VQ5yufj1vMvIaZjAo2LOpwJfZY4NfKnXsvL3ring07IVesQs6uxqQmgenMouW6ZwmNC2Tc3HN9DiFi15LgVaUL%2B48oMHBwMGRl2FuzFIE6VyL8GNvX1Yqh9cnaEI6uQz4pAqQ7L01umiFnAbLw%2BwLQAnoPxwOphO6g0%2FX7xOE2eUX9XY5c3hKU9a3s3ypyy77OFMB5cZv1HxTVeNfmm2ND2EskSYs2sL53wmF%2FCAS%2FP4W%2FPB6QRnkdNHTjP%2BdG54ilW2JoY%2BLfUyX2bEtz2UaDn70ep1p948GKYpNRqPi8KnjCwx0DvezanD86%2FADiuAVa5VHLBVkB27NB2xmf1s17lF6ZCub4D4ILDZaw8ACjLreCool1pfBPicTi6yb%2BOtUv%2B4OYIAqfeSc1zURZJ6umel1LLMqa8JfAn0UEZfS6TgGOtgSkfYOyuzdXYigMUZdncGyaobgaY0vAhMJTlnMMGOqUBjUrRb5z0FggVCfMiMrDK5CvfHQNv%2BeeguHMjOLRtXDLPPLgBBb0h6dEO2BPPbwt5xyEAqunR5DIp%2FvAZ%2BczrFXjkz4Qc5BsWgsfZZCIA8Rs6dChMQZFDTYWu2q9DkX8oIKqfhpDwPOrdGT4AydTCz50C7ZbMoVF5Fmtz5mGhr5ltKLdJqroSn2XkIZvEBJVYbdnUsw7Q1nuVaubesnEhS9dEfiCa&X-Amz-Signature=bc1e023a3842936380a90a4be4e76ad6ac5d5f84ab260812bacf76219b1bc6e6&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

3. 给todo页面 选择刚才创建的连接工具

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/7ae2573f-8f5f-4573-bb57-8253156261d0/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466V3QEMABL%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T024505Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJHMEUCIEIbYEK8GslwAL6ooVEGTnUUe2yR2C8cSY0O4WGRNeR%2FAiEAj6hmy6VvDPwVdc%2F34Wht4F1ybBL2iU3QC412P5%2FhwqEq%2FwMIIxAAGgw2Mzc0MjMxODM4MDUiDFsZXu1d7jKPSv9Y8SrcA%2FItlZL02p%2BEvY5VenG1M6cqSgs5nVloJMxxQGxRfuKuPPDgSIRQVtXdaBjSkVPr6TDLShql85OPh77wVvhhuf%2FIX0L0nAOVA5qFFo%2FR1oMWzJTm1sfyn3HRgKh9iyT6EQes%2F1Xwo26Ekfiw%2Fldz4D%2FpFrA%2F%2BWG5oxK6TCLmUQq7GXOu4TQxbV2oeRDUu3pFRBuT0oUVNoxFTrmXFawyKVHZT1S%2FwkIieORsOwkqBKRCJMk69D%2BPg0zx4wlj7pEXuKooaIxJwMsF279%2BjZCxJeVh8TObjzP01itrXDYJDi%2Fo%2B5orTo5sRSECn21rlfMHXwDEojLOqwu4KPBzAE9bdvVCQgVVH3%2BnIi2XR8SkS9f48jlswyHYSDds6KVWG8Jd%2BmAhHLwvGHOgRCcEqDPlUoJE5U82nhhwWUIsrbfWffM7q%2Fle1YrLImKs3r5Y4u49muCenV3WzRCvbt8uK%2F%2FB%2BYlaX40UJHZfOI5XAgCjq58GYPoLnZbBfXp8ck8vbflYoLVF%2B7ExnSaoUrAcH2oLWvYwVCrM2bVZ72rYq77VYHOIIPjQDNWBifqoe5ueZ0qyUF0YLRhedOTXJfUSUKvfjI%2FBEut1QpKgItxZnESllEPLLM1LHQDsacYQcWopMNnlnMMGOqUBydufj83H5Hh9zGX%2BBsbXP3sDXNsDnHf6P9dWeHSxaV%2Fu6QBbxha8%2FUjFGJH6dY82jCYN6sVcsf5KGZShXQvKcN%2B3doNCNqCCDzycuW8%2BMJzdZ%2FUILowvFzZ2TrZawYeULRwPtm%2FKM2wYyXSzY4rSzus7oFxBCvBl4r9EzZRujJ3KvjHYOJmTDcfBM72l3ojiJ8wDbvPXMyoUmWG52hceoa7EtCbI&X-Amz-Signature=61b110338984cd3073188ecdd06445bea0dede97ea571caef0c5d9555be2c0d8&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

4. 编写py代码，验证集成工具的可用性。关于notion的数据结构，参考[官方文档](https://developers.notion.com/reference/intro)

    ```python
    import asyncio
    
    import httpx
    
    
    class NotionApi:
        NOTION_KEY = '' # 此处填写集成工具的token
        database_id = '' # 此处填写database页面的id，可在todo页面的url中找到
    
        def __init__(self):
            self.url = f"https://api.notion.com/v1/pages" # api地址，可在文档中找到
            self.headers = {
                "Accept": "application/json",
                "Notion-Version": "2021-08-16",
                "Authorization": f"Bearer {self.NOTION_KEY}"
            }
    
        async def insert_page(self, content: str) -> str:
            # database属性
            properties = {
                "Name": {
                    "title": [
                        {
                            "type": "text",
                            "text": {
                                "content": f"{content[0:14]}" # 截取前14个字符为page的标题
                            }
                        }
                    ]
                },
                "Status": {
                    "status": {
                        "name": "Next Up"
                    }
                }
            }
            # 页面内容
            children = [{
                "object": "block",
                "type": "paragraph",
                "paragraph": {
                    "text": [{"type": "text", "text": {"content": content}}]
                }
            }]
            # database 信息
            parent = {"type": "database_id", "database_id": self.database_id}
            data = {
                "parent": parent,
                "properties": properties,
                "children": children
            }
            async with httpx.AsyncClient() as client:
                r = await client.post(url=self.url, headers=self.headers, json=data)
                print(r.text)
                if r.status_code == 200:
                    return "收集成功!"
                else:
                    return "收集失败!"
    
    
    notion_database = NotionApi()
    
    if __name__ == '__main__':
        asyncio.run(notion_database.insert_page("测试notion API"))
    ```


    注意：

        1. 我们刚才创建的todo页面其实是一个database
        2. 我们要创建的各个todo其实是database下面的page
        3. 因此我们使用的api 是[创建page](https://developers.notion.com/reference/post-page)
5. 正常情况下，已经执行成功，可在todo页面看到

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/9029c7ff-64f1-442f-ac7b-df9705b03350/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB46626ACENCP%2F20250704%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250704T024508Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEBoaCXVzLXdlc3QtMiJIMEYCIQD%2FDTxDretzO0xDTwqyX2IkFm%2FFQiMNDsnESghXaSwWbAIhALFYYCVavN22Ux3%2Fv8Khonv2dfVl4XGLx99DWTvk5w40Kv8DCCMQABoMNjM3NDIzMTgzODA1IgzlIGwTuMToMTNuPDUq3APUgHty5uOUScRny99fVTUcO%2F3ov7J%2FbDqROF5tjAxJMVXi7DRx2DZ%2F8uZenZOBO7682hGhfRIw8o90DhqdkeZlofyGtInbYW0W52A2jzK4%2BeoiCi6frwir4Co2SczJVUraQ2ufDTvCPYbSHrxUr5gEMBgu0t8oAakYBDz%2FykxH%2BhrP0XDHB6BOvxd7MVXT%2Bj926DPhDPXqp6oC4EG2rnUjNeAtciyvg5Wb88tQJSROzX9CZUt8A2L8BBLne3Q%2BUKYI679PjbZ1GT7Z%2BAlDtxRXS4YTwqqfIrbD%2FxvUxoh%2FaLQji3Lwj4%2FHp6hc8GLSvPcJ8g8oiqFkemD6UZEVZcq8wFvoAUDHCEc%2BafIr3%2B6kECGaa076d6TRqLNYmU5ueGE62WBhOv54PXgYstnyvB%2BElV6wRaEuI2kGU%2FF7wpI%2FzDkdNiolb5g4b9H0eQTs6LMvJb8mJwF%2BUllSnK0uP7BFiskeDmu5zDJcI9L0J2PNJ%2FhFtm8EOGYCiYc3WU%2Fvo%2B5JHFfTh3M0Mb2ycxd0wRbHM%2FO5OCgsvYH4UFmFbaxGClrm10xjpkvvsAUW3ArKk%2BmwizG4V2neY8N59%2F4h12eWhJGYjnXkkGYKLqfzYXgZx%2BYnqxKO%2F%2FOzblY3DDCu5pzDBjqkAel9RElTNkz7ywgy3aS4PkV6HP1YavE6HPeJ0x%2FiDvzGznNcerhBnng9CYtYh3Q6MwRAeBnvLrwK7fG9B8FsHEn%2FoSKGdGH21Rq7BDd7woo7UQZXg5QMEz1vJXgvJ8viauEflMLAnZBVOmZB0EBEoTjtd44z0v%2FmT8KHHI0uFtAoZ6P5v%2Bos1K6fu2DKHay7x7YA8yg%2FVCS1IBnLWLM41OUvin%2Fg&X-Amz-Signature=a8a7af63f94048cabf4814f8e0faea35fca676521c806d025eb8be04ef210699&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

6. 完整代码（bot.py）如下，在服务器执行`nohup python -u bot.py > bot.log 2>&1 &`

    ```python
    # -*- coding:utf-8 -*-
    from aiocqhttp import CQHttp, Event
    
    from action import sent
    
    import httpx
    
    
    class NotionApi:
        NOTION_KEY = ''
        database_id = ''
    
        def __init__(self):
            self.url = f"https://api.notion.com/v1/pages"
            self.headers = {
                "Accept": "application/json",
                "Notion-Version": "2021-08-16",
                "Authorization": f"Bearer {self.NOTION_KEY}"
            }
    
        async def insert_page(self, content: str) -> str:
            # database属性
            properties = {
                "Name": {
                    "title": [
                        {
                            "type": "text",
                            "text": {
                                "content": f"{content[0:14]}"
                            }
                        }
                    ]
                },
                "Status": {
                    "status": {
                        "name": "Next Up"
                    }
                }
            }
            # 页面内容
            children = [{
                "object": "block",
                "type": "paragraph",
                "paragraph": {
                    "text": [{"type": "text", "text": {"content": content}}]
                }
            }]
            # database 信息
            parent = {"type": "database_id", "database_id": self.database_id}
            data = {
                "parent": parent,
                "properties": properties,
                "children": children
            }
            async with httpx.AsyncClient() as client:
                r = await client.post(url=self.url, headers=self.headers, json=data)
                print(r.text)
                if r.status_code == 200:
                    return "收集成功!"
                else:
                    return "收集失败!"
    
    
    notion_database = NotionApi()
    
    bot = CQHttp()
    
    
    @bot.on_message('private')
    async def _(event: Event):
        n = await sent(notion_database.insert_page(event.message))
        await bot.send(event, n)
    
    
    bot.run(host='127.0.0.1', port=18080)
    ```


# 总结


整个过程中的难点是对notion API的理解，一开始以为添加todo是create a database，几经尝试后才搞清楚关系，这一点需要注意。其次是api 数据结构的组装，需要多查看[文档](https://developers.notion.com/reference/property-value-object)

