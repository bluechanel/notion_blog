---
id: 224be3c3-178a-49f0-af8e-1528acf9aa94
title: QQ Bot+notion实现随手记
slug: 224be3c3-178a-49f0-af8e-1528acf9aa94
excerpt: 小玩具
date: 2022-08-16
coverImage: /images/224be3c3-178a-49f0-af8e-1528acf9aa94_5f7f0b6047be0b8e9579ef48a693e2f5.png
lastUpdated: 2025-04-11T05:51:00.000Z
tags: yellow:Notion  
---

习惯在QQ置顶一个小号，用于“随手记”。可能是某一时刻的想法，或者是链接等，每天早晨都会看之前的随手记，有些可以看到就做。还有一些是flag，当前可能做不了，需要稍后的，QQ查看之前的聊天的记录，已完成未完成混杂在一起，查看起来有些麻烦。随着notion开放API，便想到了使用QQ或wechat输入（这个两个app每天打开无数次），notion收集。经过研究，wechat接入第三方应用非常的麻烦，可行性太低。QQ则可以借助各种qq bot工具实现第三方的接入。因此我便使用[cqhttp](https://github.com/nonebot/aiocqhttp)+python脚本实现自己的收集工具，具体过程如下(在腾讯云服务器实现)


# [cqhttp](https://github.com/Mrs4s/go-cqhttp)

1. 在[github](https://github.com/Mrs4s/go-cqhttp/releases)下载合适的安装包到本地机器，并解压 支持win，linux，macos
2. 首次执行`./go-cqhttp`，生成配置文件config.yml

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/74d2b771-a6b7-4c6b-bfb8-41fbb62aa2e4/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466W2JL46JB%2F20250703%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250703T060326Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAYaCXVzLXdlc3QtMiJHMEUCIHHpm26s7QvUUTNEyeLhyyVXKv63byhGpDbcTii4lxwtAiEA3b17vJcM69gy33E6WC0RYM7nR74maF8mRWRUf%2FYx6JsqiAQI%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDBjwwn4G5M455h8FKSrcA%2Fa%2BGiL3JQWKa9dx5wSIt4lP4Ax86%2FVrta1NCwzGgKyRrcfVdyRoYpAvDfOttZrxoAbxEJmmwZ7Zit%2Bf3QjzIysFWXmy6Y7S1I4%2F6HcYySCuZX%2FJOcf48V1HDWPp5Aipw8LSb7M26KzSzdq4wubDfHMMY%2BUUaHlyUtYzUMdKsmYFZd9OLoiL0iEREgbKfZXPQCUrY%2F%2F48UhYrYirBvV7HAsXILYdA0IRloOO5pfSX1z9OwA7%2BE1aoDTdsO9pgpej1R%2FLXTORGYKOBcz57Txd541qZBRC15dp24jhaGOWBTLt0J4Mo3U4m188x%2BsoL%2BM0FYn6HVFC0Ctq5dh09%2Bw2Ywdn5OpCs2tnuRmFNcdENvknNNVnaJW4BWtj%2BapZtwXZcfjGwfTaPMXFPgHNHBgacOAcyE8mbgri5ChxrTV%2BfuxlDXn0Imu8xR0CqMG04X%2BGhVMv2CNgAC89PSNkBCOxcbGdkTwHT%2FnnRMSI%2FbYVrftadtEWwBKg8jdpMEq05hALvTNgV0TcYfi9p3EbQe09SsDIfh%2FkhWgyaVSW9v%2BOnsQBC%2FRS%2F5%2FZwLPLpHTTXhNNO%2BfOIIepcAfSruivForBX5OtNt5sZ6LJVH64Rbc1qp1aTDVdY1NrC1vo9hSUMP2umMMGOqUBQvV0vXnTQp4h8E%2F%2BG066bABp8S40hksi%2FfIT7DqBxLhSBhnPscns%2BF6HdTaC%2FGs9BZYdJYuNc1iGbmohUELCQyacwnv6Ne8hpvtpOOD9se6xSk%2ByDLmbs5QO3hka2RZWDoCOpolXE2jrkihb6jl63zc%2FeOxg0cdoAuocY%2FlhjZ3GFYE7xCtC63hcSZt0Z3jR31CwG2oCpevBN5Wwdk1OkEPH3KhK&X-Amz-Signature=f0808bc18b8c52438c9de802a9aea838a1e784bfae4dab96b6a3e9aa8957272f&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

3. 修改config.yml ,配置账户和密码。记住下面的servers的链接端口。更新详细的[配置参考官方](https://docs.go-cqhttp.org/guide/config.html#%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF)

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/79142ab5-969e-48e6-934c-75120cc752cd/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4665BMHM5TR%2F20250703%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250703T060327Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAYaCXVzLXdlc3QtMiJHMEUCIFXhjW6VuVxH8G0DMSJIUKY0ENy2E7xa7IaExgMgcMEgAiEA8tZxtgBi10QJ%2Fi4juugDxqYTUXNJ5z9ccAu0%2Ftd9ZKAqiAQI%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDHm6NHm8xjkFxIj8VSrcA0up8jmdEuUGQC16FAjNV5iWPys303%2F5GHozPtRSAT044w098VHuFA0J8Sp%2ByqYJT1Ltn0Vr8R7w7w4d3GLNEtrSq6DpmFmapwTFb4UqQnSMaL3rYpfiNZ3UGz6cADmIYBpRaHHwyXyIW0oiDjoHQqkBzaPJIynep2L9fS8kAm7YYyoU8EWyFjR9yLWshgkG1imdc%2BJmrE7W6oqhVoT9dBD5t7vucZNfIzjUD7BkvEP%2FfBru50eMCR%2BBZ5HKZJD3RZ8FOyjxHT1aybsidMmxmXU%2BDl%2Fn9ln%2BbwYi7ECfaFDoKKrETstMu%2FEZPiBKuLsMLEtpNe00ao7bMHeBFqzjTSjX4d2iKX5JMyQNNWU1feqW3EUmNcsVU9BcxR9%2BrUtBg3xdeMhXH%2FLeFY5Xc3V6MzezOhhaCxjBG3sIeFkaDhkdXSGXqVWUjK%2FDlrQtVzuo8cKwweL5TdoSvpGt0S8mODE9aDsPIKv0fFkohtV3uZv9UPd2udllcI36BF%2FgYFzPfiD9e%2FK4v8h8qI496woB2IxRU%2FC03APh%2B08REea%2FTdjDAzDL2q2hJtEx24JDoyAdoQPgLgzYH8yYSzvd5OQretigkQdOtqf4%2FdWxcTzVUGxBAR07SXQtVJY4lCU6MK%2BvmMMGOqUBEFjcMl7AJRPGljZb7NoEpPHFkRsVzwaC5rbuwKj5Ym08BG%2Bq3Y%2F%2Buj6hJAmOL8f%2BhNzXtLD0jKzaQuU7%2BaJrh7tQVCmuqpOCgwPuseykZ%2BhHZGvXAWKfjH9vM8B3mpTObc0C8erG8mAz7je8k%2BeUUryXxzmbT0vS6ydRyhb0s79nHVl4vr51D6YRiAscxP6RBK%2FLBioN9TOCpBRSCITB6a7KL4Wa&X-Amz-Signature=787e8fd9f593c7a3a610053b5acf4d4b57e4422cbe0ae5015c2f2ded1e57a7b6&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/2dff1ba7-3e89-40cd-a7ae-15fc422a578d/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4665BMHM5TR%2F20250703%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250703T060327Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAYaCXVzLXdlc3QtMiJHMEUCIFXhjW6VuVxH8G0DMSJIUKY0ENy2E7xa7IaExgMgcMEgAiEA8tZxtgBi10QJ%2Fi4juugDxqYTUXNJ5z9ccAu0%2Ftd9ZKAqiAQI%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDHm6NHm8xjkFxIj8VSrcA0up8jmdEuUGQC16FAjNV5iWPys303%2F5GHozPtRSAT044w098VHuFA0J8Sp%2ByqYJT1Ltn0Vr8R7w7w4d3GLNEtrSq6DpmFmapwTFb4UqQnSMaL3rYpfiNZ3UGz6cADmIYBpRaHHwyXyIW0oiDjoHQqkBzaPJIynep2L9fS8kAm7YYyoU8EWyFjR9yLWshgkG1imdc%2BJmrE7W6oqhVoT9dBD5t7vucZNfIzjUD7BkvEP%2FfBru50eMCR%2BBZ5HKZJD3RZ8FOyjxHT1aybsidMmxmXU%2BDl%2Fn9ln%2BbwYi7ECfaFDoKKrETstMu%2FEZPiBKuLsMLEtpNe00ao7bMHeBFqzjTSjX4d2iKX5JMyQNNWU1feqW3EUmNcsVU9BcxR9%2BrUtBg3xdeMhXH%2FLeFY5Xc3V6MzezOhhaCxjBG3sIeFkaDhkdXSGXqVWUjK%2FDlrQtVzuo8cKwweL5TdoSvpGt0S8mODE9aDsPIKv0fFkohtV3uZv9UPd2udllcI36BF%2FgYFzPfiD9e%2FK4v8h8qI496woB2IxRU%2FC03APh%2B08REea%2FTdjDAzDL2q2hJtEx24JDoyAdoQPgLgzYH8yYSzvd5OQretigkQdOtqf4%2FdWxcTzVUGxBAR07SXQtVJY4lCU6MK%2BvmMMGOqUBEFjcMl7AJRPGljZb7NoEpPHFkRsVzwaC5rbuwKj5Ym08BG%2Bq3Y%2F%2Buj6hJAmOL8f%2BhNzXtLD0jKzaQuU7%2BaJrh7tQVCmuqpOCgwPuseykZ%2BhHZGvXAWKfjH9vM8B3mpTObc0C8erG8mAz7je8k%2BeUUryXxzmbT0vS6ydRyhb0s79nHVl4vr51D6YRiAscxP6RBK%2FLBioN9TOCpBRSCITB6a7KL4Wa&X-Amz-Signature=28d170c8cba2065d685018d1a3ae271162a999c42791f0df57f1ab82ca00207b&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

4. 再次使用`./go-cqhttp`启动，可能会展示二维码，需要使用手机扫描验证后即可登录。`ctrl+c`终止掉程序
5. 使用命令后台运行`nohup ./go-cqhttp &`

# python脚本与cq通讯


python环境的安装不在赘述。这里使用python sdk `aiocqhttp`[官网](https://aiocqhttp.nonebot.dev/#/getting-started)

1. 安装包`pip install aiocqhttp`
2. 执行最小的demo，查看链接状况

    ```javascript
    from aiocqhttp import CQHttp, Event
    
    bot = CQHttp()
    
    
    @bot.on_message('private')
    async def _(event: Event):
        await bot.send(event, '你发了：')
        return {'reply': event.message}
    
    
    bot.run(host='127.0.0.1', port=18080)
    ```

3. 这个时候使用其他的账号给小号发送消息，即可收到小号的回复

# python脚本调用notionAPI

1. 创建[notion集成工具](https://www.notion.so/my-integrations)

    填写name，为工具取名，我这里取名`Collection of materials`，以及设置访问权限后，保存。即可看到访问token


    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/d13675e1-10c9-48ca-abb4-7ac7aa58991d/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4666QTUR7AU%2F20250703%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250703T060328Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAYaCXVzLXdlc3QtMiJHMEUCIFseqMvsO3GsmC%2FPPIiQfBOXJrC%2FwjAPynvLLZGm50SGAiEAy31yd7r4kdIpK5VvICWgeQ0Brt8qVcP8gjSr9YB7xxYqiAQI%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDHq4ETDiCMWN3WS%2BvircA5xDi1GT1bO0ReuX3SI9JVm6ydlcIhBU1kfnyOAdBnCLHZfuFqRw%2BTlhgVH19qjrnO%2FoJxKIQmE40o35%2FubeX5gpU8XMT7v4fBor8gJc%2FK7WAbpP7DkHix36ktaPelgmgPy5ZXp%2FU9HXPlxmnxXdJsMxi8ryUyAnXR3HbayG4VUSIbZmOOybg8Iu4IlGHeJUfYFx4DaebwNSK0kh4Ff8oQ2cTvXdYC9e88WyT9G%2F7Q13GPNiQ2l5fpjruCq4BuHDrhwW7LF1r%2FCI5ae%2FsLct%2BersGQRq29%2FzUhdhcRJ%2F3YIEteieWQkh9WfOwSRucd0Gf3zKbc%2BNV7ga1%2FRCvwfXTE9avXlgSyohVuGOdHBuzZsMkIcNC%2B%2Fk%2BgRTqNFfFNou2I1lVhMK5Sg8bFDoRldcDq6TRjna9ih5djNbJDstQNL14eJq3oANUJkPpDK0d1qz%2BYTJcx7VdaLzhebmDgcF22cebNRwtvGJFCm8LRdSj3U896U%2BrNeOWLD6Iqt1x9JWuwzvQT4wymv1%2BxPOT1Blos74w1KU%2FoHKR1qyhkv6xI%2BPdHUHiXzmOkAUMKHhp1SBs118V4j1w9wmJ8pN6qO0QGcrELxmnBjF0vikL9MRZysKDJ%2BV3BNDI8S8IPfkMKWvmMMGOqUBS%2FW6iNRldm3BZ0bFofOgaJHvBB6xuvnEXQt%2BUvTBahe1C8Y7jAsLkqub7GjSF%2FzabGue8keSPjlXhtJBoLQdtNdTwonM1s0UFmYRd4jAOLJSIwlbPUEu5eVD0qcNDebUXCDvFfeIb9LUQz%2FUsCo3R2lxDVo4BRrxl4Z9YLMndgTWXlA2zSjOd%2FPavcbDnGiDXKhLm%2B2pQ0OpJ5CqUtz30iNqSzYs&X-Amz-Signature=cdfff0fc52ff0b30778dca05127553d23c4d58a89906aac24904171ac5321d18&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

2. 创建notion页面，使用模板库的todo。按自己需求修改

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/65e07c30-636a-406d-b39f-51e7cd961a74/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466UBISE64Q%2F20250703%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250703T060328Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAYaCXVzLXdlc3QtMiJGMEQCIHo8UaZUUALiDE1RWfbiFgV14lyxtgFhVKsRu1dkE911AiAWVObfUSLrjvd7LSiPuL68XjoKCl%2FbnRaDkMqfwLV%2BGCqIBAj%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMAZxZJL4babHgLU5cKtwDFQ%2FiyhXP6P7i%2F9ndR3SD1nUy8SGJBgTn5xZSN9xuIOcyLFDnhAWlesYbv0np%2F2aEw4BRReHubqrI1km%2FBLL34KGlyshxY%2FmC28CeRCF2tw0U1ksegbPd6enKOrbDrtwl1%2BsSMyQtI34XjpWKdeqpoGOzOLUGBetpKr50jNHYaAFBLuHjZbeXukGL%2F4RVLINzjYVpqcwhnYlN0S8kPY4K43wCmXUOSf6YMXFPvqYqbTP0BH%2FIe5pN0HYihl6jPIYdXIeolWhJx%2Fwi9NZRz32YaZM88y4Y0YO84H%2FRT3JOclKIf8X%2B5AE1CjKw1hjgRokykKLQ3Ru2nNWat8FMCvYJaJkwzUKz%2BWRD0tvzNFYx7teDy3CaPkiqymYPhbqp9RuZkbIa2fFDMK4Ucfzei65%2BvPV%2FOC06soSq1rOHZBpahspC5KDquVjAN1tCfJxvPcLwH3oh7%2FbaO8Ybdk9N1TeweCodneaWdOA78ZyMQwsmpMOZpyqp0k%2Bc3gF2bf%2Fl8Va0AYA2XSwwalE77dubCKLSWJ6a56fwUhadzNCnHuGMUJvlyIpO3BiwjB5j8IgGwYVB46eiG6q%2FQYC%2Bsn0RFlxwXN0xzzlDZRWLS2nzFrJ8%2FMLVzMm4yPjEbI2%2Fcgcwpa%2BYwwY6pgFmGYUUYIpc3LbM%2BwK5NPBf2NTSPPhbwLeUAo0SsFxpxNA0FN7H6O2Pk2Np4kb0adWv1IU%2F4LHukGdz%2BW6HvIEX7QJRp1xxUQBVq4eqXCjpGHPRo25Vd8m%2BwRcGgOpWMcbhKeZ1DIfwUyH%2BGHILYglQMwIfOERfAt5PYZRqGA64mDjsu0wwA7vCiz6PBG%2BhrQFXOFOVZYZWoS1x3ZIC%2B4Mbh59MDMLj&X-Amz-Signature=d2ae7b90a106fb0fc4469fbf2db58c1b90ce9ba857071da26e13be3f0c7e8046&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)


    我这里修改Status为Status类型，保留创建时间属性，其他删除。这里的属性关乎API中的数据结构的组装


    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/04441044-2bf6-4847-a9e7-53b6bdc233ca/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466UBISE64Q%2F20250703%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250703T060328Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAYaCXVzLXdlc3QtMiJGMEQCIHo8UaZUUALiDE1RWfbiFgV14lyxtgFhVKsRu1dkE911AiAWVObfUSLrjvd7LSiPuL68XjoKCl%2FbnRaDkMqfwLV%2BGCqIBAj%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F8BEAAaDDYzNzQyMzE4MzgwNSIMAZxZJL4babHgLU5cKtwDFQ%2FiyhXP6P7i%2F9ndR3SD1nUy8SGJBgTn5xZSN9xuIOcyLFDnhAWlesYbv0np%2F2aEw4BRReHubqrI1km%2FBLL34KGlyshxY%2FmC28CeRCF2tw0U1ksegbPd6enKOrbDrtwl1%2BsSMyQtI34XjpWKdeqpoGOzOLUGBetpKr50jNHYaAFBLuHjZbeXukGL%2F4RVLINzjYVpqcwhnYlN0S8kPY4K43wCmXUOSf6YMXFPvqYqbTP0BH%2FIe5pN0HYihl6jPIYdXIeolWhJx%2Fwi9NZRz32YaZM88y4Y0YO84H%2FRT3JOclKIf8X%2B5AE1CjKw1hjgRokykKLQ3Ru2nNWat8FMCvYJaJkwzUKz%2BWRD0tvzNFYx7teDy3CaPkiqymYPhbqp9RuZkbIa2fFDMK4Ucfzei65%2BvPV%2FOC06soSq1rOHZBpahspC5KDquVjAN1tCfJxvPcLwH3oh7%2FbaO8Ybdk9N1TeweCodneaWdOA78ZyMQwsmpMOZpyqp0k%2Bc3gF2bf%2Fl8Va0AYA2XSwwalE77dubCKLSWJ6a56fwUhadzNCnHuGMUJvlyIpO3BiwjB5j8IgGwYVB46eiG6q%2FQYC%2Bsn0RFlxwXN0xzzlDZRWLS2nzFrJ8%2FMLVzMm4yPjEbI2%2Fcgcwpa%2BYwwY6pgFmGYUUYIpc3LbM%2BwK5NPBf2NTSPPhbwLeUAo0SsFxpxNA0FN7H6O2Pk2Np4kb0adWv1IU%2F4LHukGdz%2BW6HvIEX7QJRp1xxUQBVq4eqXCjpGHPRo25Vd8m%2BwRcGgOpWMcbhKeZ1DIfwUyH%2BGHILYglQMwIfOERfAt5PYZRqGA64mDjsu0wwA7vCiz6PBG%2BhrQFXOFOVZYZWoS1x3ZIC%2B4Mbh59MDMLj&X-Amz-Signature=ca45e794e65f9f20f65fa85e93cab2d250987b1ab0323256cba74e46245fc643&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

3. 给todo页面 选择刚才创建的连接工具

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/7ae2573f-8f5f-4573-bb57-8253156261d0/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB4666K664M3J%2F20250703%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250703T060329Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAYaCXVzLXdlc3QtMiJIMEYCIQCrpjOnXbjTw4usE88W%2Bni4eFb6ky54szm%2BjwSy%2FFiubQIhAL2xUVXKRgnanDnqf%2BCTtam32J3e6ly5YzAb8afWyHq%2FKogECP%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEQABoMNjM3NDIzMTgzODA1IgxRZPWaqVhlX4peL5kq3ANEaDSdZ2dYFA5FV2%2BQgLw4BHnm78%2BYKz%2Bj1jlbJCOgMvOKIi1RNd86A9ovd%2F67ZHsqnzUAP6B3BZ7U9LrxpUXp00wZPr%2BxmC9bqzB2NmlPgovoeKxJC9qHGDkhF4tKs9fJDePBJKlpSQ4G4C50J4Mu9s3zRsutcP0DRATKuNHM6XzuZMM%2BvCv2d2z8qEXfxxnQoEc9OxzVnjb%2FHE8eWAOHISQLtWt1oJYEq6LXDGanSsRvV06QUVixSesxKqEI0ISwuSoq7YWUeLkdpCvDpiLMfktaDtuGhKvWKg5z%2F3VzFa9BY1mGhh3zyVxQ5brsNXM4bxA0p148Ha4ZAOWuF123nMc4ATVsOEasFcEGQzZh7Kle1SqKLtav7YriZDvZ1PM23ef%2B40t1yAU67d5O8vGzFKV%2BzJQOVwcOX%2Bg%2FJfi4jwRzzw9jTaAh8fUpCnLvcrLCxtRNb%2FaFvrJeZR89AT6uBQSFAaPvJpivVq49QF%2BL%2FVV7n8dhTM2K29hO%2FZo5kMdLVzqcSa4VNKp%2BlaG0%2BtJ0jLoCbHLW9ecIQjyIywr7bOWhqyA2B3GRdF%2BZEtHxu62j7GSN%2Bt0YrF5ucEwv7smrkjCuAL%2FW0VQd%2B0dHUGIxLGiUR%2FkH8lGKoyVZWjCHr5jDBjqkAcY%2FNzGRKlk7k%2FNeeip%2F2jt4gvU%2FPDBGYYDUVsd7sk2Odn%2BkwmlLkx86%2ByA%2FHhSWpeVh4pcPecwnGFivPFX8cN7ggPdpfpYQi%2F9pxfab1Stthv07pQxfFQvLDqQPq9YmWx0QyLlRGpR5wu2C7IbnzdOPKHMUpDp16794JCir6Hbyaz9da9%2BTKh0leZZ0aqmCBaRsGCv%2BMBEn7OWeD5si1kEFz5u7&X-Amz-Signature=160288975ab39fd04d6874b9fc8c186836076c2434ef641fc4d59a7d4c90feb5&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

4. 编写py代码，验证集成工具的可用性。关于notion的数据结构，参考[官方文档](https://developers.notion.com/reference/intro)

    ```python
    import asyncio
    
    import httpx
    
    
    class NotionApi:
        NOTION_KEY = '' # 此处填写集成工具的token
        database_id = '' # 此处填写database页面的id，可在todo页面的url中找到
    
        def __init__(self):
            self.url = f"https://api.notion.com/v1/pages" # api地址，可在文档中找到
            self.headers = {
                "Accept": "application/json",
                "Notion-Version": "2021-08-16",
                "Authorization": f"Bearer {self.NOTION_KEY}"
            }
    
        async def insert_page(self, content: str) -> str:
            # database属性
            properties = {
                "Name": {
                    "title": [
                        {
                            "type": "text",
                            "text": {
                                "content": f"{content[0:14]}" # 截取前14个字符为page的标题
                            }
                        }
                    ]
                },
                "Status": {
                    "status": {
                        "name": "Next Up"
                    }
                }
            }
            # 页面内容
            children = [{
                "object": "block",
                "type": "paragraph",
                "paragraph": {
                    "text": [{"type": "text", "text": {"content": content}}]
                }
            }]
            # database 信息
            parent = {"type": "database_id", "database_id": self.database_id}
            data = {
                "parent": parent,
                "properties": properties,
                "children": children
            }
            async with httpx.AsyncClient() as client:
                r = await client.post(url=self.url, headers=self.headers, json=data)
                print(r.text)
                if r.status_code == 200:
                    return "收集成功!"
                else:
                    return "收集失败!"
    
    
    notion_database = NotionApi()
    
    if __name__ == '__main__':
        asyncio.run(notion_database.insert_page("测试notion API"))
    ```


    注意：

        1. 我们刚才创建的todo页面其实是一个database
        2. 我们要创建的各个todo其实是database下面的page
        3. 因此我们使用的api 是[创建page](https://developers.notion.com/reference/post-page)
5. 正常情况下，已经执行成功，可在todo页面看到

    ![Untitled.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/da864e11-683f-4c2d-a264-16ecdf57fff9/9029c7ff-64f1-442f-ac7b-df9705b03350/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=ASIAZI2LB466V4PHADHV%2F20250703%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20250703T060329Z&X-Amz-Expires=3600&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEAYaCXVzLXdlc3QtMiJHMEUCIQCe%2FxVu%2F7Lm6l5kk1AVoHM0v4H4wH81XoQtFx%2FEsZrvfAIgJNMLXm48Y5CdVmBnHhC3JUVmkDrnwvdxv1BDIwWbtEYqiAQI%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARAAGgw2Mzc0MjMxODM4MDUiDAiDdXi3eCT7nXaXOircA1gNcx8qrXI0GbS1mQGRsBm82dZePUsP1Zh6KLLpVyi2jXZwpiA1Ilp8TRBtDMnrlPZaFijDnUwFONCnK%2BVQmOJAFZuo2%2Bgvsb72qZwGEeTqklcFHJl2ywj0UX%2FAta%2Fbol%2FivVCe9U11NI1wVdUaBztEdKg7CIYF7846KBEmGXrCNVa%2B9%2Fljp82c0vwBh8wFIeSaNDs84Fj%2Fd0JzQnPaiAUv%2B9Wzx4a0XZZ5PBgSnbL7PUeNB0S3pSiRWUY7r9M7tpm%2FIcMUSWFpeViT339rAjCBUgak0NalCQCw18GxOPh9O6nsV8IMAUMhjrfEb99x0yRMoiYhUAbgXuOIGsWHx7IqGw2tK3dBgoAV2rsWn2j04kLRLYIdrpFon7lpTDvqvxP7iFJtUJz2%2BdFprwUf%2BQZ65hlsb4rF9gRdy4ZJLv%2FDpxNX4egX63LIPKgH3s%2BT78U7eyujXAREVKdpDqpE873NsIDf6y4tS%2FOFw5M7cN%2FEj5y%2FjyHWVdVySs%2FkutNibT6GrCOwJ28ztiU4dBoE6y%2FMycGqofFKwhFpfHRybxjo%2FQ8TnGlMVUgASWIq75%2FRgspBEiog2VB72cqKrFihLqsVnwdLDtlMzdwJYWC6vvC57ILVZQgjVNpg7jhgMPyvmMMGOqUBZuaq7t0Y3Sj%2FnZuRlATEUXlT1qxb8Vkzf%2Bib79RzPSg8ZdA1w72ht6tQOct8euiQaUK9yvOyhTajfvrkV62V29iVq7QVbzfxSpfwM8T2HPjRwKvEFHLTWIrb0VINwNAUZgqsMR8oeu1tDIb0vpkByVEVm29DT9txNDYm9%2BEKgv%2Bb8DBuvg46REqQ8cWk0tL5YkGLWdv%2BhZCzamoIijkW1yFt7sA5&X-Amz-Signature=00c99c7b776ce2dd6c56ae64d7eb930f16cbf41b2e8fdd4abb201fb6fb4fff7c&X-Amz-SignedHeaders=host&x-amz-checksum-mode=ENABLED&x-id=GetObject)

6. 完整代码（bot.py）如下，在服务器执行`nohup python -u bot.py > bot.log 2>&1 &`

    ```python
    # -*- coding:utf-8 -*-
    from aiocqhttp import CQHttp, Event
    
    from action import sent
    
    import httpx
    
    
    class NotionApi:
        NOTION_KEY = ''
        database_id = ''
    
        def __init__(self):
            self.url = f"https://api.notion.com/v1/pages"
            self.headers = {
                "Accept": "application/json",
                "Notion-Version": "2021-08-16",
                "Authorization": f"Bearer {self.NOTION_KEY}"
            }
    
        async def insert_page(self, content: str) -> str:
            # database属性
            properties = {
                "Name": {
                    "title": [
                        {
                            "type": "text",
                            "text": {
                                "content": f"{content[0:14]}"
                            }
                        }
                    ]
                },
                "Status": {
                    "status": {
                        "name": "Next Up"
                    }
                }
            }
            # 页面内容
            children = [{
                "object": "block",
                "type": "paragraph",
                "paragraph": {
                    "text": [{"type": "text", "text": {"content": content}}]
                }
            }]
            # database 信息
            parent = {"type": "database_id", "database_id": self.database_id}
            data = {
                "parent": parent,
                "properties": properties,
                "children": children
            }
            async with httpx.AsyncClient() as client:
                r = await client.post(url=self.url, headers=self.headers, json=data)
                print(r.text)
                if r.status_code == 200:
                    return "收集成功!"
                else:
                    return "收集失败!"
    
    
    notion_database = NotionApi()
    
    bot = CQHttp()
    
    
    @bot.on_message('private')
    async def _(event: Event):
        n = await sent(notion_database.insert_page(event.message))
        await bot.send(event, n)
    
    
    bot.run(host='127.0.0.1', port=18080)
    ```


# 总结


整个过程中的难点是对notion API的理解，一开始以为添加todo是create a database，几经尝试后才搞清楚关系，这一点需要注意。其次是api 数据结构的组装，需要多查看[文档](https://developers.notion.com/reference/property-value-object)

